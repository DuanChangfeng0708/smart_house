#include <stdio.h>
#include <fcntl.h>
#include <unistd.h>
#include <stdlib.h>
#include <sys/stat.h>
#include <sys/mman.h>
#include <sys/types.h>
#include<stdlib.h>
#include"LcdOperation.h"
#include"dateWinget.h"
#include<pthread.h>
char word[][32*29/8]={
    /*--  文字:  温  --*/
    /*--  微软雅黑 Light22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x07,0x1F,0xFF,0x00,0x07,0x9F,0xFF,0x80,0x03,0xDC,0x0F,0x80,0x01,0xDC,0x6F,0x00,
    0x00,0x0F,0xFE,0x00,0x00,0x0F,0x8E,0x00,0x38,0x0E,0x1C,0x00,0x3E,0x0F,0xFC,0x00,
    0x1E,0x0F,0xF8,0x00,0x0E,0x04,0x00,0x00,0x00,0x00,0x02,0x00,0x01,0x80,0xFF,0x80,
    0x01,0xFF,0xFF,0xC0,0x03,0xBF,0x7F,0x80,0x07,0x3B,0x77,0x00,0x07,0x3B,0xF7,0x00,
    0x0E,0x1B,0xF7,0x00,0x1E,0x1B,0xF7,0x00,0x3C,0x1B,0xFF,0xE0,0x1D,0xFF,0xFF,0xF0,
    0x0C,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00
    },

    /*--  文字:  度  --*/
    /*--  楷体22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x80,0x00,0x00,0x03,0xC0,0x00,
    0x00,0x01,0xC0,0x00,0x00,0x00,0xFC,0x00,0x01,0xFF,0xF8,0x00,0x01,0xFF,0x60,0x00,
    0x01,0xC0,0x70,0x00,0x01,0xDC,0x7E,0x00,0x01,0xDF,0xFF,0x00,0x01,0xFF,0xF8,0x00,
    0x01,0xFE,0x60,0x00,0x01,0xCF,0xE0,0x00,0x01,0xCF,0xE0,0x00,0x03,0x86,0x60,0x00,
    0x03,0x83,0xF8,0x00,0x03,0xBF,0xF0,0x00,0x03,0x1C,0x70,0x00,0x07,0x1E,0xE0,0x00,
    0x07,0x0F,0xE0,0x00,0x0E,0x03,0xC0,0x00,0x0C,0x03,0xE0,0x00,0x1C,0x0F,0xF8,0x00,
    0x38,0x3E,0x7F,0x00,0x71,0xF8,0x3F,0xF0,0x00,0x00,0x0F,0xF0,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00

    },
    /*--  文字:  湿  --*/
    /*--  楷体22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x00,
    0x0F,0x80,0xFF,0x00,0x07,0xFF,0xFF,0x00,0x03,0xBC,0x0F,0x00,0x00,0x38,0xCE,0x00,
    0x00,0x1F,0xEE,0x00,0x00,0x1F,0x9E,0x00,0x3C,0x1C,0x1C,0x00,0x1E,0x1F,0xFC,0x00,
    0x1E,0x0F,0xF8,0x00,0x00,0x0C,0x00,0x00,0x00,0x0E,0x70,0x00,0x01,0x87,0xFF,0x80,
    0x03,0x07,0x77,0x80,0x07,0x77,0x77,0x00,0x06,0x7F,0x7E,0x00,0x0E,0x3F,0x7C,0x00,
    0x1E,0x3F,0x78,0x00,0x3C,0x07,0x70,0x00,0x3C,0x07,0x7F,0xE0,0x1D,0xFF,0xFF,0xF0,
    0x0F,0xFF,0xE0,0x60,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00},

    /*--  文字:  度  --*/
    /*--  楷体22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x80,0x00,0x00,0x03,0xC0,0x00,
    0x00,0x01,0xC0,0x00,0x00,0x00,0xFC,0x00,0x01,0xFF,0xF8,0x00,0x01,0xFF,0x60,0x00,
    0x01,0xC0,0x70,0x00,0x01,0xDC,0x7E,0x00,0x01,0xDF,0xFF,0x00,0x01,0xFF,0xF8,0x00,
    0x01,0xFE,0x60,0x00,0x01,0xCF,0xE0,0x00,0x01,0xCF,0xE0,0x00,0x03,0x86,0x60,0x00,
    0x03,0x83,0xF8,0x00,0x03,0xBF,0xF0,0x00,0x03,0x1C,0x70,0x00,0x07,0x1E,0xE0,0x00,
    0x07,0x0F,0xE0,0x00,0x0E,0x03,0xC0,0x00,0x0C,0x03,0xE0,0x00,0x1C,0x0F,0xF8,0x00,
    0x38,0x3E,0x7F,0x00,0x71,0xF8,0x3F,0xF0,0x00,0x00,0x0F,0xF0,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00
    },

    /*--  文字:  海  --*/
    /*--  楷体22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x80,0x00,0x00,0x03,0xC0,0x00,
    0x07,0x83,0x80,0x00,0x03,0xC7,0xBF,0x00,0x03,0xC7,0xFC,0x00,0x01,0xCE,0xE0,0x00,
    0x00,0x0C,0x00,0x00,0x18,0x18,0x3C,0x00,0x1E,0x0F,0xFE,0x00,0x0F,0x0F,0x9E,0x00,
    0x07,0x0F,0xCE,0x00,0x00,0x0E,0xFE,0x00,0x01,0x8C,0x7F,0xF0,0x03,0xFF,0xFF,0xF0,
    0x03,0xFF,0x1C,0x00,0x07,0x19,0xDC,0x00,0x0E,0x39,0xDC,0x00,0x1E,0x7F,0xFC,0x00,
    0x3E,0xFF,0xFF,0x80,0x3C,0xE0,0x3F,0xC0,0x1C,0x00,0x38,0xC0,0x0C,0x00,0x38,0x00,
    0x00,0x03,0xF8,0x00,0x00,0x01,0xF0,0x00,0x00,0x00,0xF0,0x00,0x00,0x00,0xE0,0x00,
    0x00,0x00,0x00,0x00},

    /*--  文字:  拔  --*/
    /*--  楷体22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xC0,0x00,0x00,0x01,0xE1,0xE0,0x00,
    0x01,0xE0,0xEF,0x00,0x01,0xC0,0xE7,0x80,0x01,0xC0,0xE3,0x80,0x01,0xC0,0xC0,0x00,
    0x01,0xC1,0xC7,0x00,0x01,0xF1,0xFF,0x80,0x03,0xFF,0xFE,0x00,0x1F,0xEF,0xC0,0x00,
    0x0F,0xC3,0x9C,0x00,0x01,0xC3,0xFE,0x00,0x01,0xF3,0xFE,0x00,0x01,0xE3,0x1C,0x00,
    0x03,0xC7,0x9C,0x00,0x0F,0xC7,0xDC,0x00,0x3F,0xCE,0xF8,0x00,0x7D,0xCC,0x78,0x00,
    0x31,0xDC,0x78,0x00,0x01,0xF8,0xFE,0x00,0x01,0xF1,0xFF,0x00,0x07,0xC7,0x8F,0xC0,
    0x03,0xC4,0x07,0xF8,0x03,0xC0,0x01,0x80,0x01,0x80,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00},

    /*--  文字:  气  --*/
    /*--  楷体22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x3C,0x00,0x00,
    0x00,0x78,0xF0,0x00,0x00,0x7F,0xF0,0x00,0x00,0xFF,0x80,0x00,0x01,0xC0,0x00,0x00,
    0x07,0x87,0xC0,0x00,0x00,0x3F,0xC0,0x00,0x00,0x18,0x00,0x00,0x00,0x00,0xE0,0x00,
    0x00,0x07,0xF0,0x00,0x00,0xFF,0xE0,0x00,0x0F,0xF0,0xE0,0x00,0x02,0x01,0xC0,0x00,
    0x00,0x01,0xC0,0x00,0x00,0x01,0xC0,0x00,0x00,0x01,0xC0,0x00,0x00,0x01,0xC0,0x00,
    0x00,0x01,0xC0,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0xF0,0x60,0x00,0x00,0x78,0xE0,
    0x00,0x00,0x3E,0xE0,0x00,0x00,0x1F,0xE0,0x00,0x00,0x0F,0xF0,0x00,0x00,0x00,0x40,
    0x00,0x00,0x00,0x00},

    /*--  文字:  压  --*/
    /*--  楷体22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x7E,0x00,0x03,0xDF,0xFE,0x00,0x01,0xFF,0xE0,0x00,0x01,0xC0,0x00,0x00,
    0x01,0xC3,0xC0,0x00,0x01,0xC1,0xE0,0x00,0x01,0xC1,0xC0,0x00,0x01,0xC1,0xC0,0x00,
    0x03,0x81,0xCC,0x00,0x03,0x81,0xFE,0x00,0x03,0x9F,0xF8,0x00,0x03,0x8F,0xC0,0x00,
    0x07,0x81,0xDE,0x00,0x07,0x01,0xDE,0x00,0x07,0x01,0xCF,0x00,0x0F,0x01,0xC7,0x00,
    0x0E,0x01,0xC3,0x80,0x1C,0x0F,0xFF,0xE0,0x1F,0xFF,0xFF,0xE0,0x39,0xF0,0x00,0x00,
    0x70,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00
    },
    /*--  文字:  烟  --*/
    /*--  楷体22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x80,0x00,0x00,
    0x03,0xC0,0x00,0x00,0x03,0xC0,0x07,0x00,0x03,0x80,0x7F,0x80,0x03,0x8F,0xFF,0xC0,
    0x03,0xBE,0x03,0xC0,0x03,0xFE,0x73,0x80,0x03,0xFE,0x73,0x80,0x3B,0xCE,0x73,0x80,
    0x3F,0x8E,0x7F,0x80,0x1F,0x8F,0xFB,0x80,0x1F,0x8E,0x73,0x80,0x0B,0x8E,0x7B,0x80,
    0x03,0x8E,0xFF,0x80,0x03,0xCE,0xFF,0xC0,0x03,0xEF,0xCF,0xC0,0x07,0xFF,0x83,0xC0,
    0x07,0x7E,0x03,0xC0,0x0E,0x0E,0x7F,0xC0,0x0E,0x0F,0xFF,0xC0,0x1C,0x0F,0x83,0xC0,
    0x38,0x04,0x03,0x80,0x60,0x00,0x01,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00
    },

    /*--  文字:  雾  --*/
    /*--  楷体22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xC0,0x00,0x00,0x3F,0xC0,0x00,
    0x00,0x3E,0x00,0x00,0x00,0x0E,0xFE,0x00,0x06,0x7F,0xFF,0x80,0x0F,0xFE,0xCF,0x80,
    0x0E,0xEF,0xEC,0x00,0x1E,0x7E,0x80,0x00,0x1D,0x8F,0xE0,0x00,0x19,0xF8,0x60,0x00,
    0x00,0x7F,0xC0,0x00,0x00,0x7F,0xE0,0x00,0x00,0xF3,0xC0,0x00,0x01,0xFF,0x80,0x00,
    0x03,0x9F,0x00,0x00,0x02,0x3F,0xE0,0x00,0x00,0xFC,0xFC,0x00,0x03,0xFE,0x7F,0xE0,
    0x0F,0xBF,0xFF,0xE0,0x3D,0xFE,0xF0,0x00,0x00,0x38,0xE0,0x00,0x00,0x78,0xE0,0x00,
    0x00,0x71,0xC0,0x00,0x01,0xEF,0xC0,0x00,0x03,0xC7,0xC0,0x00,0x0E,0x03,0x80,0x00,
    0x00,0x00,0x00,0x00
    },

    /*--  文字:  浓  --*/
    /*--  楷体22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0xE0,0x00,
    0x00,0x01,0xE0,0x00,0x07,0x81,0xC0,0x00,0x07,0xC1,0xDF,0x00,0x03,0x81,0xFF,0x80,
    0x00,0x3F,0xDF,0x00,0x00,0x3B,0x9C,0x00,0x00,0x3B,0x98,0x00,0x18,0x77,0x00,0x00,
    0x1E,0x77,0x0E,0x00,0x0E,0x0F,0x8F,0x00,0x06,0x0F,0x9E,0x00,0x00,0x1D,0xF8,0x00,
    0x03,0x1E,0xF0,0x00,0x03,0x3F,0x70,0x00,0x07,0x36,0x70,0x00,0x06,0x66,0x38,0x00,
    0x0E,0xC6,0x1E,0x00,0x0F,0x8E,0x7F,0x00,0x1E,0x0F,0xCF,0xC0,0x1C,0x0F,0x87,0xF0,
    0x1C,0x1F,0x00,0x00,0x0C,0x1E,0x00,0x00,0x00,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00
    },

    /*--  文字:  度  --*/
    /*--  楷体22;  此字体下对应的点阵为：宽x高=30x29   --*/
    /*--  宽度不是8的倍数，现调整为：宽度x高度=32x29  --*/
    {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x80,0x00,0x00,0x03,0xC0,0x00,
    0x00,0x01,0xC0,0x00,0x00,0x00,0xFC,0x00,0x01,0xFF,0xF8,0x00,0x01,0xFF,0x60,0x00,
    0x01,0xC0,0x70,0x00,0x01,0xDC,0x7E,0x00,0x01,0xDF,0xFF,0x00,0x01,0xFF,0xF8,0x00,
    0x01,0xFE,0x60,0x00,0x01,0xCF,0xE0,0x00,0x01,0xCF,0xE0,0x00,0x03,0x86,0x60,0x00,
    0x03,0x83,0xF8,0x00,0x03,0xBF,0xF0,0x00,0x03,0x1C,0x70,0x00,0x07,0x1E,0xE0,0x00,
    0x07,0x0F,0xE0,0x00,0x0E,0x03,0xC0,0x00,0x0C,0x03,0xE0,0x00,0x1C,0x0F,0xF8,0x00,
    0x38,0x3E,0x7F,0x00,0x71,0xF8,0x3F,0xF0,0x00,0x00,0x0F,0xF0,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00
    }
};


void DateWiget(struct Point *point,int *smoke,struct GY39Date *gy39date,int *des)
{
    //背景
    display_bmp(0,0,"../image/spiderMan.bmp",des);
    struct Point *p=(struct Point *)malloc(sizeof(struct Point));
    p->x=-1;
    p->y=-1;
    //烟雾浓度
    lcd_draw_word(350,44,32,29,word[8],0x0069F1EE,des);
    lcd_draw_word(380,44,32,29,word[9],0x0069F1EE,des);
    lcd_draw_word(410,44,32,29,word[10],0x0069F1EE,des);
    lcd_draw_word(440,44,32,29,word[11],0x0069F1EE,des);
    //温度
    lcd_draw_word(140,176,32,29,word[0],0x0069F1EE,des);
    lcd_draw_word(170,176,32,29,word[1],0x0069F1EE,des);
    //湿度
    lcd_draw_word(560,176,32,29,word[2],0x0069F1EE,des);
    lcd_draw_word(590,176,32,29,word[3],0x0069F1EE,des);
    //气压
    lcd_draw_word(140,352,32,29,word[6],0x0069F1EE,des);
    lcd_draw_word(170,352,32,29,word[7],0x0069F1EE,des);
    //海拔
    lcd_draw_word(560,352,32,29,word[4],0x0069F1EE,des);
    lcd_draw_word(590,352,32,29,word[5],0x0069F1EE,des);
    int smo,tem,hum,pre,alt;
    smo=tem=hum=pre=alt=0;
    while (1)
    {
        if(point->x!=p->x||point->y!=p->y)
        {
            p->x=point->x;
            p->y=point->y;
            
            if((p->x-25)*(p->x-25)+(p->y-25)*(p->y-25)<25*25)       //有鼠标事件立即返回
            {
                free(p);
                return ;//返回主菜单;
            }
        }
        if(smo!=*smoke||gy39date->temperature!=tem||gy39date->humidity!=hum
                ||gy39date->pressure!=pre||gy39date->altitude!=alt) //数据有变才更新
        {
            //printf("烟雾浓度：%d，",*smoke);
            //烟雾浓度
            draw_orth(350,88,112,20,0x00ffffff,des);
            lcd_draw_Num(350,88,16,19,*smoke,0x0010489c,des);
            //printf("温度：%d,湿度：%d,气压:%d,海拔:%d\n",gy39date->temperature,gy39date->humidity,gy39date->pressure,gy39date->altitude);
            //温度
            draw_orth(140,220,112,20,0x00ffffff,des);
            lcd_draw_Num(140,220,16,19,gy39date->temperature,0x0010489c,des);
            //湿度
            draw_orth(560,220,112,20,0x00ffffff,des);
            lcd_draw_Num(560,220,16,19,gy39date->humidity,0x0010489c,des);
            //气压
            draw_orth(140,396,112,20,0x00ffffff,des);
            lcd_draw_Num(140,396,16,19,gy39date->pressure,0x0010489c,des);
            //海拔
            draw_orth(560,396,112,20,0x00ffffff,des);
            lcd_draw_Num(560,396,16,19,gy39date->altitude,0x0010489c,des);
            smo=*smoke;
            tem=gy39date->temperature;
            hum=gy39date->humidity;
            pre=gy39date->pressure;
            alt=gy39date->altitude;
        }   
    } 
}
    
    




